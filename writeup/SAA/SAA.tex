\documentclass[12pt]{article}
\usepackage{amsmath,amssymb,mathtools}
\usepackage{setspace}
\usepackage[margin=1in]{geometry}
\newcommand{\data}{\text{training data}}
%\doublespacing

\title{Sample Average Approximation for Optimizing Probability of Improvement and Expectation of Improvement}

\begin{document}
\maketitle

Let $\theta^{(k)}$ represent the full set of Naive Bayes parameters, $\theta_{y,i}^{(k)}(j)$, for $y=0,1$ being whether the peptide is a substrate for enzyme $k$, $i=-20,...,-1,1,...,20$ being position of amino-acids in the peptide and $j=1,...,8$ denoting the class each amino-acid belongs to. Here $k$ denotes different types of enzyme, and in our case $k=1,2$.

We have

\begin{equation*}
P(Y(x,k)=1|\theta^{(k)})=\frac{P(Y(x,k)=1)\prod_i\theta_{1,i}^{(k)}(x_i)}{P(Y(x,k)=1)\prod_i\theta_{1,i}^{(k)}(x_i)+P(Y(x,k)=0)\prod_i\theta_{0,i}^{(k)}(x_i)}
\end{equation*}

\begin{equation*}
P(Y(x,k)=0|\theta^{(k)})=\frac{P(Y(x,k)=0)\prod_i\theta_{0,i}^{(k)}(x_i)}{P(Y(x,k)=1)\prod_i\theta_{1,i}^{(k)}(x_i)+P(Y(x,k)=0)\prod_i\theta_{0,i}^{(k)}(x_i)}
\end{equation*}

Therefore,

\begin{equation*}
\frac{P(Y(x,k)=1|\theta^{(k)})}{P(Y(x,k)=0|\theta^{(k)})} \propto \prod_i\frac{\theta_{1,i}^{(k)}(x_i)}{\theta_{0,i}^{(k)}(x_i)}
\end{equation*}

We let

\begin{equation*}
\eta_i^{(k)}(x_i) = \frac{\theta_{1,i}^{(k)}(x_i)}{\theta_{0,i}^{(k)}(x_i)}
\end{equation*}

Then we have

\begin{equation*}
P(Y(x,k)=1|\theta^{(k)})=\frac{\prod_i\eta_i^{(k)}(x_i)}{1+\prod_i\eta_i^{(k)}(x_i)}
\end{equation*}

Now, suppose we're given a set of $N$ peptides: $S=(X)_{n=1}^n$, then the probability that all peptides in $S$ are not substrate for enzyme $k$ is:

\begin{eqnarray*}
P(Y(X_1,k)=0,...,Y(X_N,k)=0) & = & E_{\theta^{(k)}}[P(Y(X_1,k)=0,...,Y(X_N,k)=0|\theta^{(k)})] \\
                             & = & E_{\theta^{(k)}}[\prod_nP(Y(X_n,k)=0|\theta^{(k)})] \\
                             & = & E_{\theta^{(k)}}[\prod_n\frac{1}{1+\prod_i\eta_i^{(k)}(x_i)}]
\end{eqnarray*}

The second equality follows from that given $\theta^{(k)}$, the probability each peptide in $S$ is a substrate for enzyme $k$ is independent. To estimate the above expectation, we can use the sample average approximation approach. We first simulate a set of $L$ different $\eta^{(k)}$ parameters: $\{\eta_{i,l}^{(k)}(j):i=-20,...,-1,1,...20,j=1,..8\}_{l=1}^L$, then we estimate the above expectation as

\begin{equation*}
\hat{E}_{\theta^{(k)}}[\prod_n\frac{1}{1+\prod_i\eta_i^{(k)}(x_i)}] = \frac{1}{L}\sum_{l=1}^L\frac{1}{\prod_n[1+\prod_i\eta_{i,l}^{(k)}(x_i)]}
\end{equation*}

To increase the probability of improvement, we should minimize the above the expectation. If we introduce a new set of variables $z$:

\begin{equation*}
z_{i,j}^n =\left\{\begin{array}{ll} 1 & \textrm{if } x_{n,i}=j \\
                               0 & \textrm{otherwise} \end{array}\right.
\end{equation*}

we're facing an optimization problem:

\begin{align*}
&\min_z\frac{1}{L}\sum_{l=1}^L\frac{1}{\prod_n[1+\prod_i(\sum_j\eta_{i,l}^{(k)}(j)z_{i,j}^n)]} \\
&\begin{array}{lll}\textrm{s.t.}& \sum_{j=1}^8z^n_{i,j}=1 & i=-20,...,-1,1,...20,n=1,...,N\\
                                  & z^n_{i,j}\in\{0,1\} & i=-20,...,-1,1,...20,j=1,...,8,n=1,...,N\end{array}
\end{align*}


                             

\end{document}